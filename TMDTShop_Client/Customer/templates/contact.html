<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Li√™n H·ªá - ShopX</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <link rel="icon" type="image/png" href="/Customer/assets/images/logo.jpg">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="../assets/css/style.css">
  <style>
    /* Chatbot Animations */
@keyframes bounce-in {
    0% { transform: scale(0.3) rotate(-45deg); opacity: 0; }
    50% { transform: scale(1.05) rotate(-10deg); }
    70% { transform: scale(0.9) rotate(5deg); }
    100% { transform: scale(1) rotate(0deg); opacity: 1; }
}

@keyframes pulse-slow {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

#botpress-chat-toggle {
    animation: bounce-in 0.6s ease-out;
}

#chat-status {
    animation: pulse-slow 2s infinite;
}

/* ‚úÖ Responsive adjustments */
@media (max-width: 768px) {
    #botpress-chat-toggle {
        bottom: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
    }
    
    #botpress-chat-toggle i {
        font-size: 1.25rem;
    }
}

/* ‚úÖ High contrast mode support */
@media (prefers-contrast: high) {
    #botpress-chat-toggle {
        border: 2px solid white;
    }
}

/* ‚úÖ Reduced motion support */
@media (prefers-reduced-motion: reduce) {
    #botpress-chat-toggle {
        animation: none;
        transition: none;
    }
    
    #chat-status {
        animation: none;
    }
}
  </style>
</head>

<body class="bg-gray-50 font-sans">
  <!-- Header Container -->
  <div id="header-container"></div>

  <!-- Main Content -->
  <main class="container mx-auto px-4 py-8">
    <!-- Contact Hero -->
    <section class="relative bg-gradient-to-r from-blue-600 to-indigo-700 py-20 mb-12 rounded-lg shadow-xl">
      <div class="container mx-auto px-4 text-center text-white">
        <h1 class="text-4xl md:text-5xl font-bold mb-4 animate-fade-in-down">Li√™n h·ªá v·ªõi ch√∫ng t√¥i</h1>
        <p class="text-lg md:text-xl animate-fade-in-up">M·ªçi th·∫Øc m·∫Øc v√† y√™u c·∫ßu h·ªó tr·ª£, vui l√≤ng li√™n h·ªá qua th√¥ng tin
          b√™n d∆∞·ªõi ho·∫∑c g·ª≠i tin nh·∫Øn cho ch√∫ng t√¥i.</p>
      </div>
    </section>

    <!-- Contact Content -->
    <section class="py-16 bg-white rounded-lg shadow-xl">
      <div class="container mx-auto px-4">
        <div class="flex flex-col lg:flex-row gap-12">
          <!-- Contact Form -->
          <div class="lg:w-2/3 xl:w-1/2">
            <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-6">G·ª≠i tin nh·∫Øn cho ch√∫ng t√¥i</h2>
            <form id="contactForm" class="space-y-6">
              <div>
                <label for="contactMessage" class="block text-sm font-medium text-gray-700 mb-2">N·ªôi dung li√™n h·ªá <span
                    class="text-red-500">*</span></label>
                <textarea id="contactMessage" name="message" rows="6" required
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-shadow shadow-sm"
                  placeholder="Nh·∫≠p n·ªôi dung b·∫°n mu·ªën g·ª≠i... (t·ªëi thi·ªÉu 10 k√Ω t·ª±)"></textarea>
                <p id="messageError" class="text-red-500 text-xs mt-1 hidden">N·ªôi dung ph·∫£i t·ª´ 10 ƒë·∫øn 2000 k√Ω t·ª±.</p>
              </div>
              <button type="submit" id="submitContactBtn"
                class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                <i class="fas fa-paper-plane mr-2"></i>G·ª≠i tin nh·∫Øn
              </button>
              <div id="formFeedback" class="mt-4 text-sm"></div>
            </form>
          </div>

          <!-- Contact Info -->
          <div class="lg:w-1/3 xl:w-1/2 mt-12 lg:mt-0">
            <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-6">Th√¥ng tin li√™n h·ªá</h2>
            <div class="space-y-6">
              <div class="flex items-start p-4 bg-indigo-50 rounded-lg shadow">
                <div class="bg-indigo-100 p-3 rounded-full mr-4 flex-shrink-0">
                  <i class="fas fa-map-marker-alt text-indigo-600 text-xl"></i>
                </div>
                <div>
                  <h3 class="font-bold text-lg mb-1">ƒê·ªãa ch·ªâ c·ª≠a h√†ng</h3>
                  <p class="text-gray-600">11 L√Ω Th∆∞·ªùng Ki·ªát, P. Ph√∫ Nhu·∫≠n, TP. Hu·∫ø</p>
                </div>
              </div>

              <div class="flex items-start p-4 bg-indigo-50 rounded-lg shadow">
                <div class="bg-indigo-100 p-3 rounded-full mr-4 flex-shrink-0">
                  <i class="fas fa-phone-alt text-indigo-600 text-xl"></i>
                </div>
                <div>
                  <h3 class="font-semibold text-lg text-gray-700 mb-1">ƒêi·ªán tho·∫°i</h3>
                  <p class="text-gray-600">1900 1234 (H·ªó tr·ª£ 24/7)</p>
                </div>
              </div>

              <div class="flex items-start p-4 bg-indigo-50 rounded-lg shadow">
                <div class="bg-indigo-100 p-3 rounded-full mr-4 flex-shrink-0">
                  <i class="fas fa-envelope text-indigo-600 text-xl"></i>
                </div>
                <div>
                  <h3 class="font-semibold text-lg text-gray-700 mb-1">Email</h3>
                  <p class="text-gray-600"><a href="mailto:support@shopx.vn"
                      class="hover:underline">support@shopx.vn</a></p>
                </div>
              </div>
            </div>

            <div class="mt-12">
              <h3 class="font-bold text-lg mb-4">Theo d√µi ch√∫ng t√¥i</h3>
              <div class="flex space-x-4">
                <a href="https://www.facebook.com/quocminh20" class="bg-blue-600 text-white p-3 rounded-full hover:bg-blue-700 transition">
                  <i class="fab fa-facebook-f"></i>
                </a>
                <a href="#" class="bg-pink-600 text-white p-3 rounded-full hover:bg-pink-700 transition">
                  <i class="fab fa-instagram"></i>
                </a>
                <a href="#" class="bg-blue-400 text-white p-3 rounded-full hover:bg-blue-500 transition">
                  <i class="fab fa-twitter"></i>
                </a>
                <a href="#" class="bg-red-600 text-white p-3 rounded-full hover:bg-red-700 transition">
                  <i class="fab fa-youtube"></i>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

  </main>

  <!-- Footer Container -->
  <div id="footer-container"></div>
  

  <!-- Chatbot -->
<!-- ‚úÖ ENHANCED Chatbot v·ªõi better UI -->
<div class="fixed bottom-6 right-6 z-50">
  <!-- Chat Toggle Button -->
  <button id="botpress-chat-toggle" 
          class="bg-blue-600 hover:bg-blue-700 text-white rounded-full w-14 h-14 flex items-center justify-center shadow-lg transition-all duration-300 transform hover:scale-110 focus:outline-none focus:ring-4 focus:ring-blue-300" 
          aria-label="Chat v·ªõi ShopX AI"
          title="Chat v·ªõi ShopX AI">
      <i id="chat-icon" class="fas fa-robot text-2xl"></i>
      <i id="loading-icon" class="fas fa-spinner fa-spin text-2xl hidden"></i>
  </button>
  
  <!-- ‚úÖ NEW: Chat Status Indicator -->
  <div id="chat-status" class="absolute -top-2 -right-2 w-4 h-4 bg-green-500 rounded-full border-2 border-white hidden animate-pulse"></div>
  
  <!-- ‚úÖ NEW: Notification Badge -->
  <div id="chat-notification" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold hidden">
    !
  </div>
  
  <!-- Botpress Scripts -->
  <script src="https://cdn.botpress.cloud/webchat/v2.5/inject.js"></script>
  <script src="https://files.bpcontent.cloud/2025/05/16/06/20250516065823-OF1G5JIH.js"></script>
</div>

  <!-- Scripts -->
  <script src="../assets/js/index.js"></script>
  <script type="module" src="../assets/js/components.js"></script>
  <script>
    // ‚úÖ ENHANCED Botpress Configuration v·ªõi Error Handling
    (function() {
        'use strict';
        
        let botpressReady = false;
        let chatToggleButton;
        let chatIcon;
        let loadingIcon;
        let chatStatus;
        
        // Wait for DOM to be ready
        function initializeChatbot() {
            chatToggleButton = document.getElementById('botpress-chat-toggle');
            chatIcon = document.getElementById('chat-icon');
            loadingIcon = document.getElementById('loading-icon');
            chatStatus = document.getElementById('chat-status');
            
            if (!chatToggleButton) {
                console.error('Chatbot toggle button not found');
                return;
            }
            
            // Show loading state
            showLoadingState();
            
            // Initialize Botpress with error handling
            initializeBotpress();
            
            // Bind events
            bindChatEvents();
        }
        
        function showLoadingState() {
            if (chatIcon && loadingIcon) {
                chatIcon.classList.add('hidden');
                loadingIcon.classList.remove('hidden');
            }
            
            if (chatToggleButton) {
                chatToggleButton.disabled = true;
                chatToggleButton.title = 'ƒêang kh·ªüi t·∫°o chatbot...';
            }
        }
        
        function showReadyState() {
            if (chatIcon && loadingIcon) {
                chatIcon.classList.remove('hidden');
                loadingIcon.classList.add('hidden');
            }
            
            if (chatToggleButton) {
                chatToggleButton.disabled = false;
                chatToggleButton.title = 'Chat v·ªõi ShopX AI';
            }
            
            if (chatStatus) {
                chatStatus.classList.remove('hidden');
            }
            
            botpressReady = true;
        }
        
        function showErrorState() {
            if (chatIcon && loadingIcon) {
                chatIcon.classList.remove('hidden');
                loadingIcon.classList.add('hidden');
                chatIcon.className = 'fas fa-exclamation-triangle text-2xl text-red-300';
            }
            
            if (chatToggleButton) {
                chatToggleButton.disabled = true;
                chatToggleButton.title = 'Chatbot kh√¥ng kh·∫£ d·ª•ng';
                chatToggleButton.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                chatToggleButton.classList.add('bg-gray-400', 'cursor-not-allowed');
            }
        }
        
        async function initializeBotpress() {
            try {
                // Check if Botpress WebChat is available
                if (typeof window.botpressWebChat === 'undefined') {
                    throw new Error('Botpress WebChat not loaded');
                }
                
                // ‚úÖ ENHANCED: Get user info if logged in
                const userInfo = getUserInfo();
                
                // Initialize with enhanced config
                await window.botpressWebChat.init({
                    botId: "9c478974-8f3b-4df2-ad85-28261b16c4ae",
                    clientId: "9c478974-8f3b-4df2-ad85-28261b16c4ae",
                    hostUrl: "https://mediafiles.botpress.cloud",
                    messagingUrl: "https://messaging.botpress.cloud",
                    botName: "ShopX Bot",
                    fontFamily: "-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif",
                    showConversationsButton: false,
                    enableReset: true,
                    
                    // ‚úÖ NEW: User context integration
                    ...(userInfo && {
                        userId: userInfo.userId,
                        userName: userInfo.fullName,
                        userEmail: userInfo.email
                    }),
                    
                    // ‚úÖ NEW: Styling customization
                    stylesheet: `
                        .bpw-chat-container {
                            border-radius: 12px !important;
                            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04) !important;
                        }
                        .bpw-header {
                            background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%) !important;
                            border-radius: 12px 12px 0 0 !important;
                        }
                        .bpw-send-button {
                            background-color: #2563eb !important;
                        }
                    `,
                    
                    // ‚úÖ NEW: Welcome message
                    welcomeMessage: userInfo ? 
                        `Xin ch√†o ${userInfo.fullName}! T√¥i l√† ShopX Bot, c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n h√¥m nay?` :
                        'Xin ch√†o! T√¥i l√† ShopX Bot, c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n h√¥m nay?'
                });
                
                console.log('‚úÖ Botpress WebChat initialized successfully');
                showReadyState();
                
                // ‚úÖ Setup event listeners for chat events
                setupChatEventListeners();
                
            } catch (error) {
                console.error('‚ùå Botpress initialization failed:', error);
                showErrorState();
                
                // ‚úÖ Fallback: Show contact form link
                if (chatToggleButton) {
                    chatToggleButton.addEventListener('click', () => {
                        alert('Chatbot t·∫°m th·ªùi kh√¥ng kh·∫£ d·ª•ng. Vui l√≤ng s·ª≠ d·ª•ng form li√™n h·ªá ph√≠a tr√™n.');
                    });
                }
            }
        }
        
        function getUserInfo() {
            try {
                // ‚úÖ Integration v·ªõi session management t·ª´ index.js
                if (typeof getSession === 'function') {
                    const token = getSession('token');
                    const userInfo = getSession('userInfo');
                    
                    if (token && userInfo) {
                        return {
                            userId: userInfo.userID || userInfo.userId,
                            fullName: userInfo.fullName,
                            email: userInfo.email
                        };
                    }
                }
            } catch (error) {
                console.warn('Could not get user info for chatbot:', error);
            }
            return null;
        }
        
        function setupChatEventListeners() {
            try {
                // ‚úÖ Listen for chat open/close events
                window.botpressWebChat.onEvent((event) => {
                    switch (event.type) {
                        case 'webchat:opened':
                            console.log('üí¨ Chat opened');
                            // Hide notification badge
                            const notification = document.getElementById('chat-notification');
                            if (notification) {
                                notification.classList.add('hidden');
                            }
                            break;
                            
                        case 'webchat:closed':
                            console.log('üí¨ Chat closed');
                            break;
                            
                        case 'message:received':
                            console.log('üì® New message received');
                            // Show notification if chat is closed
                            const notificationBadge = document.getElementById('chat-notification');
                            if (notificationBadge && !isChatOpen()) {
                                notificationBadge.classList.remove('hidden');
                            }
                            break;
                    }
                });
            } catch (error) {
                console.warn('Could not setup chat event listeners:', error);
            }
        }
        
        function bindChatEvents() {
            if (!chatToggleButton) return;
            
            chatToggleButton.addEventListener('click', () => {
                if (!botpressReady) {
                    console.warn('Botpress not ready yet');
                    return;
                }
                
                try {
                    window.botpressWebChat.sendEvent({ type: 'toggle' });
                } catch (error) {
                    console.error('Error toggling chat:', error);
                    alert('C√≥ l·ªói x·∫£y ra khi m·ªü chatbot. Vui l√≤ng th·ª≠ l·∫°i.');
                }
            });
            
            // ‚úÖ NEW: Keyboard shortcut (Ctrl + Alt + C)
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.altKey && e.key === 'c' && botpressReady) {
                    e.preventDefault();
                    window.botpressWebChat.sendEvent({ type: 'toggle' });
                }
            });
        }
        
        function isChatOpen() {
            try {
                return window.botpressWebChat && window.botpressWebChat.isOpen();
            } catch (error) {
                return false;
            }
        }
        
        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeChatbot);
        } else {
            // DOM already loaded, wait a bit for other scripts
            setTimeout(initializeChatbot, 500);
        }
        
        // ‚úÖ Global error handler for chatbot
        window.addEventListener('error', (event) => {
            if (event.message && event.message.includes('botpress')) {
                console.error('Botpress error detected:', event.error);
                showErrorState();
            }
        });
        
    })();
    </script>
  <script>
    // ƒê·∫£m b·∫£o script n√†y ch·∫°y sau khi index.js v√† components.js ƒë√£ ƒë∆∞·ª£c load
    function initializeContactPage() {
      const contactForm = document.getElementById('contactForm');
      const contactMessageInput = document.getElementById('contactMessage');
      const messageErrorElement = document.getElementById('messageError');
      const submitButton = document.getElementById('submitContactBtn');
      const formFeedbackElement = document.getElementById('formFeedback');

      // Ki·ªÉm tra c√°c h√†m v√† bi·∫øn to√†n c·ª•c t·ª´ index.js
      if (typeof API_BASE_URL === 'undefined' || typeof getSession !== 'function' || typeof checkAuthTokenForPage !== 'function') {
        console.error("M·ªôt s·ªë h√†m ho·∫∑c bi·∫øn to√†n c·ª•c t·ª´ index.js ch∆∞a s·∫µn s√†ng. Trang li√™n h·ªá c√≥ th·ªÉ kh√¥ng ho·∫°t ƒë·ªông ƒë√∫ng.");
        formFeedbackElement.innerHTML = '<p class="text-red-600">L·ªói t·∫£i trang. Vui l√≤ng l√†m m·ªõi l·∫°i.</p>';
        if (submitButton) submitButton.disabled = true;
        return;
      }

      // Ki·ªÉm tra ƒëƒÉng nh·∫≠p khi trang t·∫£i
      if (!checkAuthTokenForPage()) {
        // checkAuthTokenForPage ƒë√£ x·ª≠ l√Ω chuy·ªÉn h∆∞·ªõng n·∫øu c·∫ßn
        // C√≥ th·ªÉ hi·ªÉn th·ªã th√¥ng b√°o y√™u c·∫ßu ƒëƒÉng nh·∫≠p n·∫øu mu·ªën
        formFeedbackElement.innerHTML = '<p class="text-yellow-600">Vui l√≤ng <a href="/Customer/templates/login.html" class="font-bold hover:underline">ƒëƒÉng nh·∫≠p</a> ƒë·ªÉ g·ª≠i li√™n h·ªá.</p>';
        if (submitButton) submitButton.disabled = true; // V√¥ hi·ªáu h√≥a n√∫t g·ª≠i n·∫øu ch∆∞a ƒëƒÉng nh·∫≠p
        return; // D·ª´ng ·ªü ƒë√¢y n·∫øu ch∆∞a ƒëƒÉng nh·∫≠p
      }


      if (contactForm && contactMessageInput && submitButton) {
        contactForm.addEventListener('submit', async function (event) {
          event.preventDefault();
          formFeedbackElement.innerHTML = ''; // X√≥a th√¥ng b√°o c≈©
          messageErrorElement.classList.add('hidden');

          const message = contactMessageInput.value.trim();

          // Validate message length
          if (message.length < 10 || message.length > 2000) {
            messageErrorElement.classList.remove('hidden');
            contactMessageInput.focus();
            return;
          }

          const token = getSession('token');
          if (!token) {
            formFeedbackElement.innerHTML = '<p class="text-red-600">L·ªói: B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p ho·∫∑c phi√™n ƒë√£ h·∫øt h·∫°n. Vui l√≤ng <a href="/Customer/templates/login.html" class="font-bold hover:underline">ƒëƒÉng nh·∫≠p l·∫°i</a>.</p>';
            return;
          }

          const originalButtonText = submitButton.innerHTML;
          submitButton.disabled = true;
          submitButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>ƒêang g·ª≠i...';

          const contactData = {
            message: message
          };

          try {
            const response = await fetch(`${API_BASE_URL}/Contacts`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
              },
              body: JSON.stringify(contactData)
            });

            if (response.ok) {
              const result = await response.json(); // ContactDto
              formFeedbackElement.innerHTML = `<p class="text-green-600 font-semibold">Y√™u c·∫ßu li√™n h·ªá c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c g·ª≠i th√†nh c√¥ng! Ch√∫ng t√¥i s·∫Ω ph·∫£n h·ªìi s·ªõm nh·∫•t c√≥ th·ªÉ. (ID: ${result.contactID})</p>`;
              contactForm.reset(); // X√≥a form sau khi g·ª≠i th√†nh c√¥ng
            } else {
              const errorData = await response.json().catch(() => ({ message: "Kh√¥ng th·ªÉ g·ª≠i y√™u c·∫ßu. Vui l√≤ng th·ª≠ l·∫°i." }));
              let errorMessage = `L·ªói ${response.status}: ${errorData.message || "ƒê√£ c√≥ l·ªói x·∫£y ra."}`;
              if (response.status === 400 && errorData.errors) { // X·ª≠ l√Ω l·ªói validation chi ti·∫øt t·ª´ ASP.NET Core
                const validationErrors = Object.values(errorData.errors).flat().join('<br>');
                errorMessage = `L·ªói d·ªØ li·ªáu: <br>${validationErrors}`;
              } else if (response.status === 401) {
                errorMessage = "Phi√™n ƒëƒÉng nh·∫≠p kh√¥ng h·ª£p l·ªá ho·∫∑c ƒë√£ h·∫øt h·∫°n. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.";
              }
              formFeedbackElement.innerHTML = `<p class="text-red-600">${errorMessage}</p>`;
            }
          } catch (error) {
            console.error('L·ªói khi g·ª≠i li√™n h·ªá:', error);
            formFeedbackElement.innerHTML = '<p class="text-red-600">ƒê√£ x·∫£y ra l·ªói k·∫øt n·ªëi m√°y ch·ªß. Vui l√≤ng th·ª≠ l·∫°i sau.</p>';
          } finally {
            submitButton.disabled = false;
            submitButton.innerHTML = originalButtonText;
          }
        });
      } else {
        console.error("Kh√¥ng t√¨m th·∫•y form li√™n h·ªá ho·∫∑c c√°c tr∆∞·ªùng c·∫ßn thi·∫øt.");
      }
    }

    // Ch·∫°y h√†m kh·ªüi t·∫°o sau khi DOM ƒë√£ s·∫µn s√†ng v√† c√°c script kh√°c ƒë√£ load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeContactPage);
    } else {
      // DOMContentLoaded ƒë√£ x·∫£y ra, components.js c√≥ th·ªÉ v·∫´n ƒëang load
      setTimeout(initializeContactPage, 200); // Ch·ªù 200ms ƒë·ªÉ components load xong
    }
  </script>
</body>

</html>