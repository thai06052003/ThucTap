<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trang chủ - ShopX</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="../assets/css/style.css">
</head>

<body class="bg-gray-50">
  <!-- Header Container -->
  <div id="header-container"></div>

  <!-- Main Content -->
  <main class="container mx-auto px-4 py-8">
    <!-- Your existing content here -->
    <!-- Hero Banner -->
    <section class="relative bg-gray-800">
      <!-- background-image-keyword: shopping banner; background-image-color: black -->
      <div class="absolute inset-0 bg-gradient-to-r from-black via-transparent to-transparent z-10"></div>
      <div class="absolute inset-0 bg-cover bg-center opacity-70"
        style="background-image: url('https://images.unsplash.com/photo-1555529669-e69e7aa0ba9a?ixlib=rb-4.0.3&amp;ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&amp;auto=format&amp;fit=crop&amp;w=1920&amp;q=80')">
      </div>

      <div class="container mx-auto px-4 py-24 relative z-20">
        <div class="max-w-xl">
          <h1 class="text-4xl md:text-5xl font-bold text-white mb-4">Siêu sale tháng 11</h1>
          <p class="text-gray-300 mb-6">Giảm giá lên đến 50% cho tất cả sản phẩm điện tử. Ưu đãi chỉ có trong tháng này!
          </p>
          <a href="promotion.html"
            class="inline-block bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition transform hover:scale-105">
            Mua ngay <i class="fas fa-arrow-right ml-2"></i>
          </a>
        </div>
      </div>
    </section>
    <!-- Danh mục sản phẩm -->
    <section class="py-12 bg-white" id="category">
      <div class="container mx-auto px-4">
        <div class="flex items-center justify-between mb-8">
          <h2 class="text-2xl font-bold">Danh mục sản phẩm</h2>
          <div class="flex space-x-2">
            <button id="scrollCategoryLeft"
              class="scroll-btn bg-gray-200 hover:bg-gray-300 text-gray-700 p-2 rounded-full disabled:opacity-50 disabled:cursor-not-allowed">
              <i class="fas fa-chevron-left"></i>
            </button>
            <button id="scrollCategoryRight"
              class="scroll-btn bg-gray-200 hover:bg-gray-300 text-gray-700 p-2 rounded-full disabled:opacity-50 disabled:cursor-not-allowed">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </div>

        <div class="category-scroll-container"> <!-- Container cha (tùy chọn) -->
          <div id="categoryGridWrapper"> <!-- Container để cuộn -->
            <div id="categoryGrid" class="flex flex-nowrap gap-4 py-1">
              <!-- Thêm py-1 để thấy rõ hơn, và flex-nowrap -->
              <!-- Danh mục sẽ được chèn vào đây bởi JavaScript -->
              <p id="categoryLoading" class="text-center text-gray-500 whitespace-nowrap px-4">Đang tải danh mục...</p>
            </div>
          </div>
        </div>
        <!-- </div> --> <!-- ĐÓNG GRID LAYOUT BỊ BỎ -->
      </div>
    </section>

    <!-- Featured Products -->
    <section class="py-12 bg-gray-50">
      <div class="container mx-auto px-4">
        <div class="flex items-center justify-between mb-8">
          <h2 class="text-2xl font-bold">Sản phẩm nổi bật</h2>
          <a href="#" class="text-blue-600 hover:text-blue-800 flex items-center">
            Xem tất cả <i class="fas fa-chevron-right ml-1 text-sm"></i>
          </a>
        </div>

        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6 featured-products-container">
          <!-- Sản phẩm sẽ được tải từ API và hiển thị ở đây -->
          <div class="col-span-full text-center py-4">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"></div>
            <p class="mt-2 text-gray-500">Đang tải sản phẩm nổi bật...</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Banner -->
    <section class="py-12 bg-white">
      <div class="container mx-auto px-4">
        <div
          class="bg-gradient-to-r from-blue-600 to-blue-800 rounded-xl p-8 md:p-12 flex flex-col md:flex-row items-center">
          <div class="md:w-1/2 mb-6 md:mb-0">
            <h2 class="text-2xl md:text-3xl font-bold text-white mb-4">Nhận ngay ưu đãi 10%</h2>
            <p class="text-blue-100 mb-6">Đăng ký nhận bản tin của chúng tôi để nhận ngay mã giảm giá 10% cho đơn hàng
              đầu
              tiên.</p>
            <div class="flex">
              <input type="email" placeholder="Nhập email của bạn"
                class="bg-white/20 text-white placeholder-blue-200 border border-blue-400 rounded-l-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-300 focus:border-blue-300 w-full">
              <button
                class="bg-yellow-400 hover:bg-yellow-500 text-blue-800 font-bold px-6 rounded-r-lg transition">Gửi</button>
            </div>
          </div>
          <div class="md:w-1/2 flex justify-center">
            <img data-image-keyword="discount" data-image-color="yellow"
              src="https://images.unsplash.com/photo-1607082348824-0a96f2a4b9da?ixlib=rb-4.0.3&amp;ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&amp;auto=format&amp;fit=crop&amp;w=500&amp;q=80"
              class="w-64 h-64 object-contain">
          </div>
        </div>
      </div>
    </section>


    <!-- New Arrivals -->
    <section class="py-12 bg-gray-50">
      <div class="container mx-auto px-4">
        <div class="flex items-center justify-between mb-8">
          <h2 class="text-2xl font-bold">Sản phẩm mới</h2>
          <a href="#" class="text-blue-600 hover:text-blue-800 flex items-center">
            Xem tất cả <i class="fas fa-chevron-right ml-1 text-sm"></i>
          </a>
        </div>

        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6 new-arrivals-container">
          <!-- Sản phẩm sẽ được tải từ API và hiển thị ở đây -->
          <div class="col-span-full text-center py-4">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"></div>
            <p class="mt-2 text-gray-500">Đang tải sản phẩm mới...</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Chatbot -->
    <div class="fixed bottom-6 right-6 z-50">
      <button
        class="bg-blue-600 hover:bg-blue-700 text-white rounded-full w-14 h-14 flex items-center justify-center shadow-lg transition transform hover:scale-110">
        <i class="fas fa-robot text-2xl"></i>
      </button>
    </div>
  </main>

  <!-- Footer Container -->
  <div id="footer-container"></div>

  <!-- Scripts -->
  <script src="../assets/js/index.js"></script>
  <script type="module" src="../assets/js/components.js"></script>
  <script>

    document.addEventListener('DOMContentLoaded', () => {
      const categoryGridWrapper = document.getElementById('categoryGridWrapper');
      const categoryGrid = document.getElementById('categoryGrid');
      const categoryLoading = document.getElementById('categoryLoading');
      const scrollCategoryLeftBtn = document.getElementById('scrollCategoryLeft');
      const scrollCategoryRightBtn = document.getElementById('scrollCategoryRight');


      async function fetchAndDisplayCategories() {
        if (!categoryGrid || !categoryLoading || !categoryGridWrapper) return;
        // Hiển thị loading, xóa nội dung cũ của grid
        categoryLoading.style.display = 'block'; // Hiển thị lại loading message
        categoryGrid.innerHTML = ''; // Xóa các danh mục cũ
        categoryGrid.appendChild(categoryLoading); // Đưa loading vào lại grid


        try {
          const response = await fetch(`${API_BASE_URL}/Categories/all`);
          if (!response.ok) {
            throw new Error(`Không thể tải danh mục: HTTP ${response.status}`);
          }
          const categories = await response.json();

          categoryGrid.innerHTML = ''; // Xóa loading message

          if (categories && categories.length > 0) {
            categories.forEach(category => {
              const imageUrl = getImageUrl(category.image);
              const linkElement = document.createElement('a');
              linkElement.href = `category-products.html?categoryId=${category.categoryID}`;
              // Quan trọng: Đảm bảo mỗi item danh mục không bị co lại và có độ rộng nhất định
              linkElement.className = "bg-white hover:shadow-lg rounded-lg p-4 text-center transition transform hover:scale-105 border border-gray-200 flex flex-col items-center justify-start group w-32 sm:w-36 flex-shrink-0";
              linkElement.innerHTML = `
                              <div class="w-20 h-20 sm:w-24 sm:h-24 rounded-full flex items-center justify-center mx-auto mb-2 overflow-hidden border border-gray-100 group-hover:border-blue-300">
                                  <img src="${imageUrl}" alt="${category.categoryName}" class="w-full h-full object-cover">
                              </div>
                              <h3 class="font-medium text-xs sm:text-sm text-gray-700 group-hover:text-blue-600 mt-1 line-clamp-2">${category.categoryName}</h3>
                          `;
              linkElement.addEventListener('click', function (event) {
                event.preventDefault();
                setSession('categoryName', category.categoryName);
                setSession('categoryId', category.categoryID);
                window.location.href = this.href;
              });
              categoryGrid.appendChild(linkElement);
            });
            // Đảm bảo categoryGridWrapper có thể scroll nếu nội dung tràn ra
            categoryGridWrapper.scrollLeft = 0; // Reset vị trí cuộn về đầu
            updateScrollButtonsState();
          } else {
            categoryGrid.innerHTML = '<p class="text-center text-gray-500 whitespace-nowrap">Không có danh mục nào để hiển thị.</p>';
            disableScrollButtons();
          }

        } catch (error) {
          console.error('Lỗi khi tải và hiển thị danh mục:', error);
          if (categoryGrid) categoryGrid.innerHTML = `<p class="text-center text-red-500 whitespace-nowrap">Đã xảy ra lỗi khi tải danh mục. ${error.message}</p>`;
          disableScrollButtons();
        }
      }
      function disableScrollButtons() {
        if (scrollCategoryLeftBtn) scrollCategoryLeftBtn.disabled = true;
        if (scrollCategoryRightBtn) scrollCategoryRightBtn.disabled = true;
      }

      function updateScrollButtonsState() {
        if (!categoryGridWrapper || !scrollCategoryLeftBtn || !scrollCategoryRightBtn) return;

        const scrollLeft = categoryGridWrapper.scrollLeft;
        const scrollWidth = categoryGridWrapper.scrollWidth;
        const clientWidth = categoryGridWrapper.clientWidth;

        scrollCategoryLeftBtn.disabled = scrollLeft <= 0;
        scrollCategoryRightBtn.disabled = scrollLeft >= (scrollWidth - clientWidth - 1); // -1 để xử lý sai số nhỏ
      }


      if (scrollCategoryLeftBtn && scrollCategoryRightBtn && categoryGridWrapper) {
        const scrollAmount = 1000; // Độ rộng cuộn mỗi lần click, bạn có thể điều chỉnh

        scrollCategoryLeftBtn.addEventListener('click', () => {
          categoryGridWrapper.scrollLeft -= scrollAmount;
        });

        scrollCategoryRightBtn.addEventListener('click', () => {
          categoryGridWrapper.scrollLeft += scrollAmount;
        });

        // Cập nhật trạng thái nút khi người dùng cuộn thủ công (nếu có thanh cuộn)
        categoryGridWrapper.addEventListener('scroll', updateScrollButtonsState);
      }

      fetchAndDisplayCategories();


    });
  </script>
</body>

</html>