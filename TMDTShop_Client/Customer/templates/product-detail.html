<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi ti·∫øt S·∫£n ph·∫©m - ShopX</title> <!-- S·∫Ω c·∫≠p nh·∫≠t b·∫±ng t√™n s·∫£n ph·∫©m -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="icon" type="image/png" href="/Customer/assets/images/logo.jpg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/style.css"> <!-- Link CSS chung c·ªßa b·∫°n -->
    <style>
        /* Th√™m CSS t√πy ch·ªânh n·∫øu c·∫ßn */
        .main-product-image {
            max-height: 500px;
            /* Gi·ªõi h·∫°n chi·ªÅu cao ·∫£nh ch√≠nh */
            object-fit: contain;
            /* Hi·ªÉn th·ªã to√†n b·ªô ·∫£nh, c√≥ th·ªÉ c√≥ kho·∫£ng tr·ªëng */
        }

        .thumbnail-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .thumbnail-image.active,
        .thumbnail-image:hover {
            border-color: #3b82f6;
            /* blue-500 */
        }
    </style>
</head>

<body class="bg-gray-100">
    <!-- Header Container -->
    <div id="header-container"></div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <section class="bg-white p-6 md:p-8 rounded-lg shadow-md">
            <!-- Breadcrumbs -->
            <nav class="text-sm mb-6" aria-label="Breadcrumb">
                <ol class="list-none p-0 inline-flex">
                    <li class="flex items-center">
                        <a href="index.html" class="text-gray-500 hover:text-blue-600">Trang ch·ªß</a>
                        <i class="fas fa-chevron-right mx-2 text-gray-400 text-xs"></i>
                    </li>
                    <li class="flex items-center">
                        <a href="#" id="breadcrumbCategoryLink" class="text-gray-500 hover:text-blue-600">
                            <span id="breadcrumbCategoryName">Danh m·ª•c</span>
                        </a>
                        <i class="fas fa-chevron-right mx-2 text-gray-400 text-xs"></i>
                    </li>
                    <li class="flex items-center">
                        <span id="breadcrumbProductName" class="text-gray-700 font-medium">T√™n s·∫£n ph·∫©m</span>
                    </li>
                </ol>
            </nav>

            <!-- Product Details Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8" id="productDetailContainer">
                <!-- Product Images (C·∫ßn c·∫≠p nh·∫≠t n·∫øu API tr·∫£ v·ªÅ nhi·ªÅu ·∫£nh) -->
                <div class="product-images">
                    <div class="mb-4">
                        <img id="mainProductImage" src="../assets/images/placeholder-lg.png" alt="·∫¢nh s·∫£n ph·∫©m ch√≠nh"
                            class="w-full rounded-lg shadow-sm main-product-image">
                    </div>
                    <!-- Gallery ·∫£nh nh·ªè (n·∫øu c√≥) -->
                    <!--
          <div class="flex space-x-2 overflow-x-auto pb-2" id="thumbnailGallery">
            <img src="../assets/images/placeholder.png" alt="Thumbnail 1" class="thumbnail-image active">
            <img src="../assets/images/placeholder.png" alt="Thumbnail 2" class="thumbnail-image">
          </div>
          -->
                </div>

                <!-- Product Info -->
                <div class="product-info">
                    <input type="hidden" value="" id="productIdHidden"> <!-- ƒê·ªïi id ƒë·ªÉ tr√°nh nh·∫ßm l·∫´n -->
                    <h1 id="productName" class="text-3xl font-bold text-gray-800 mb-3">ƒêang t·∫£i t√™n s·∫£n ph·∫©m...</h1>
                    <!-- Rating v√† s·ªë l∆∞·ª£ng b√°n (v√≠ d·ª•) -->
                    <div class="flex items-center mb-4 text-sm">
                        <div class="flex text-yellow-400">
                            <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                                class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>
                        </div>
                        <span class="text-gray-500 ml-2">(150 ƒë√°nh gi√°)</span>
                        <span class="text-gray-500 mx-2">|</span>
                        <span class="text-gray-500"><span id="soldCount">1.2k</span> ƒë√£ b√°n</span>
                    </div>

                    <div class="price-section mb-6">
                        <span id="productPrice" class="text-3xl font-bold text-red-600">0ƒë</span>
                        <!-- <span id="originalPrice" class="text-xl text-gray-400 line-through ml-3">0ƒë</span> -->
                        <!-- <span id="discountBadge" class="bg-red-100 text-red-700 text-xs font-semibold px-2.5 py-0.5 rounded ml-3">GI·∫¢M 0%</span> -->
                    </div>

                    <div class="mb-6">
                        <h3 class="text-sm font-semibold text-gray-700 mb-1">Ng∆∞·ªùi b√°n:</h3>
                        <a href="#" id="sellerLink" class="text-blue-600 hover:underline">
                            <i class="fas fa-store mr-1"></i><span id="sellerStoreName">ƒêang t·∫£i...</span>
                        </a>
                    </div>

                    <div class="mb-6">
                        <h3 class="text-sm font-semibold text-gray-700 mb-1">Danh m·ª•c:</h3>
                        <a href="#" id="categoryLinkDetail" class="text-blue-600 hover:underline">
                            <span id="categoryNameDetail">ƒêang t·∫£i...</span>
                        </a>
                    </div>


                    <!-- Quantity Selector -->
                    <div class="mb-6">
                        <label for="quantityInput" class="block text-sm font-medium text-gray-700 mb-2">S·ªë
                            l∆∞·ª£ng:</label>
                        <div class="flex items-center relative"> <!-- Th√™m relative cho container cha -->
                            <button id="decreaseQuantity"
                                class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-l-md transition-colors duration-150 focus:outline-none focus:ring-1 focus:ring-gray-400 relative z-0"
                                aria-label="Gi·∫£m s·ªë l∆∞·ª£ng">
                                <i class="fas fa-minus"></i>
                            </button>
                            <input type="number" id="quantityInput" name="quantity" value="1" min="1" max="99" class="w-16 text-center border-t border-b border-gray-200 py-2 px-0  text-gray-800 font-medium  focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500  appearance-none [-moz-appearance:textfield]  relative focus:z-10"
                            aria-label="S·ªë l∆∞·ª£ng s·∫£n ph·∫©m">
                            <button id="increaseQuantity"
                                class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-r-md transition-colors duration-150 focus:outline-none focus:ring-1 focus:ring-gray-400 relative z-0"
                                aria-label="TƒÉng s·ªë l∆∞·ª£ng">
                                <i class="fas fa-plus"></i>
                            </button>
                            <span class="text-sm text-gray-500 ml-4">(C√≤n <span id="stockQuantityInfo">0</span> s·∫£n
                                ph·∫©m)</span>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex flex-col sm:flex-row gap-3">
                        <button id="addToCartBtn"
                            class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-150 ease-in-out flex items-center justify-center">
                            <i class="fas fa-cart-plus mr-2"></i>Th√™m v√†o gi·ªè h√†ng
                        </button>
                        <button id="buyNowBtn"
                            class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg transition duration-150 ease-in-out">
                            Mua ngay
                        </button>
                    </div>
                </div>
            </div>

            <!-- Product Description & Details (Tabbed or Accordion) -->
            <div class="mt-12 pt-8 border-t border-gray-200">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">M√¥ t·∫£ s·∫£n ph·∫©m</h2>
                <div id="productDescription" class="prose max-w-none text-gray-700 leading-relaxed">
                    <p>ƒêang t·∫£i m√¥ t·∫£ s·∫£n ph·∫©m...</p>
                </div>
            </div>

            <!-- Related Products (T√πy ch·ªçn) -->
            <section class="mt-12 pt-8 border-t border-gray-200">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">S·∫£n ph·∫©m li√™n quan</h2>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6"
                    id="relatedProductsGrid">
                    <!-- S·∫£n ph·∫©m li√™n quan s·∫Ω ƒë∆∞·ª£c load ·ªü ƒë√¢y -->
                </div>
            </section>
        </section>
    </main>

    <!-- Footer Container -->
    <div id="footer-container"></div>

    <script src="../assets/js/index.js"></script>
    <script type="module" src="../assets/js/components.js"></script>
    <script>
        // API_BASE_URL s·∫Ω ƒë∆∞·ª£c n·∫°p t·ª´ index.js
    
        document.addEventListener('DOMContentLoaded', async () => {
            const productIdHiddenEl = document.getElementById('productIdHidden');
            const mainProductImage = document.getElementById('mainProductImage');
            const productNameEl = document.getElementById('productName');
            const productPriceEl = document.getElementById('productPrice');
            const sellerStoreNameEl = document.getElementById('sellerStoreName');
            const categoryNameDetailEl = document.getElementById('categoryNameDetail');
            const stockQuantityInfoEl = document.getElementById('stockQuantityInfo');
            const productDescriptionEl = document.getElementById('productDescription');
    
            const breadcrumbCategoryNameEl = document.getElementById('breadcrumbCategoryName');
            const breadcrumbProductNameEl = document.getElementById('breadcrumbProductName');
            const breadcrumbCategoryLinkEl = document.getElementById('breadcrumbCategoryLink');
            const categoryLinkDetailEl = document.getElementById('categoryLinkDetail');
    
            const quantityInput = document.getElementById('quantityInput');
            const decreaseQuantityBtn = document.getElementById('decreaseQuantity');
            const increaseQuantityBtn = document.getElementById('increaseQuantity');
            const addToCartBtn = document.getElementById('addToCartBtn');
    
            let currentProductData = null; // L∆∞u d·ªØ li·ªáu s·∫£n ph·∫©m hi·ªán t·∫°i
    
            function getProductIdFromUrl() {
                const params = new URLSearchParams(window.location.search);
                return params.get('productId');
            }
    
            function formatCurrency(amount) {
                if (typeof amount !== 'number') return 'N/A';
                return amount.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
            }
    
            function getProductImageUrl(imageURL) {
                if (!imageURL || imageURL === "/images/string" || imageURL === "string") {
                    return '../assets/images/placeholder-lg.png';
                }
                return imageURL;
            }
    
            async function fetchProductDetails(productIdParam) {
    try {
        console.log(`üîç Fetching product details for ID: ${productIdParam}`);
        
        // ‚úÖ SECURITY: Use customer-specific endpoint - NO WAY to access inactive products
        const response = await fetch(`${API_BASE_URL}/Products/Customer/${productIdParam}`);
        
        if (!response.ok) {
            if (response.status === 404) {
                throw new Error('S·∫£n ph·∫©m kh√¥ng t·ªìn t·∫°i ho·∫∑c ƒë√£ ng·ª´ng b√°n.');
            } else if (response.status === 403) {
                throw new Error('B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p s·∫£n ph·∫©m n√†y.');
            } else if (response.status === 500) {
                throw new Error('L·ªói m√°y ch·ªß. Vui l√≤ng th·ª≠ l·∫°i sau.');
            } else {
                throw new Error(`L·ªói ${response.status}: Kh√¥ng th·ªÉ t·∫£i s·∫£n ph·∫©m.`);
            }
        }

        const productData = await response.json();
        console.log(`‚úÖ Product data received:`, productData);
        
        // ‚úÖ SECURITY: Additional client-side verification (defense in depth)
        if (!productData.isActive) {
            throw new Error('S·∫£n ph·∫©m ƒë√£ ng·ª´ng b√°n.');
        }
        
        currentProductData = productData;
        displayProductDetails(currentProductData);
        
    } catch (error) {
        console.error('‚ùå Error fetching product details:', error);
        showProductError(error.message);
    }
}

// ‚úÖ For admin/seller interfaces, use appropriate endpoints:
// Admin: `/api/Products/Admin/${productId}?includeInactive=true`
// Seller: `/api/Products/Seller/${productId}?includeInactive=true`
// Customer: `/api/Products/Customer/${productId}` (no includeInactive parameter)
            function displayProductDetails(product) {
                if (!product) return;
    
                console.log('üé® Displaying product details:', product);
    
                document.title = `${product.productName || 'Chi ti·∫øt s·∫£n ph·∫©m'} - ShopX`;
    
                if (productIdHiddenEl) productIdHiddenEl.value = product.productID;
                if (mainProductImage) mainProductImage.src = getProductImageUrl(product.imageURL);
                if (productNameEl) productNameEl.textContent = product.productName || 'N/A';
                if (productPriceEl) productPriceEl.textContent = formatCurrency(product.price);
    
                if (sellerStoreNameEl) sellerStoreNameEl.textContent = product.sellerStoreName || 'Kh√¥ng r√µ';
                if (document.getElementById('sellerLink')) {
                    document.getElementById('sellerLink').href = `seller-profile.html?id=${product.sellerID}`;
                }
    
                if (categoryNameDetailEl) categoryNameDetailEl.textContent = product.categoryName || 'Kh√¥ng r√µ';
                if (categoryLinkDetailEl) {
                    categoryLinkDetailEl.href = `category-products.html?categoryId=${product.categoryID}`;
                }
    
                if (stockQuantityInfoEl) stockQuantityInfoEl.textContent = product.stockQuantity || 0;
                if (quantityInput) {
                    quantityInput.max = product.stockQuantity || 1;
                    if (product.stockQuantity < 1) {
                        quantityInput.value = 0;
                        quantityInput.min = 0;
                        quantityInput.disabled = true;
                        if (addToCartBtn) {
                            addToCartBtn.disabled = true;
                            addToCartBtn.innerHTML = '<i class="fas fa-times-circle mr-2"></i>H·∫øt h√†ng';
                            addToCartBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                            addToCartBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                        }
                        stockQuantityInfoEl.textContent = "H·∫øt h√†ng";
                    } else {
                        quantityInput.value = 1;
                        quantityInput.min = 1;
                        quantityInput.disabled = false;
                        if (addToCartBtn) {
                            addToCartBtn.disabled = false;
                            addToCartBtn.innerHTML = '<i class="fas fa-cart-plus mr-2"></i>Th√™m v√†o gi·ªè h√†ng';
                            addToCartBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                            addToCartBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                        }
                    }
                }
    
                if (productDescriptionEl) {
                    const description = product.description || 'Kh√¥ng c√≥ m√¥ t·∫£ chi ti·∫øt cho s·∫£n ph·∫©m n√†y.';
                    productDescriptionEl.innerHTML = description.replace(/\n/g, '<br>');
                }
    
                if (breadcrumbCategoryNameEl) breadcrumbCategoryNameEl.textContent = product.categoryName || 'Danh m·ª•c';
                if (breadcrumbProductNameEl) breadcrumbProductNameEl.textContent = product.productName || 'S·∫£n ph·∫©m';
                if (breadcrumbCategoryLinkEl) {
                    breadcrumbCategoryLinkEl.href = `category-products.html?categoryId=${product.categoryID}`;
                }
    
                console.log('‚úÖ Product details displayed successfully');
            }
    
            // ‚úÖ ENHANCED: Quantity handlers with better validation
            if (decreaseQuantityBtn && increaseQuantityBtn && quantityInput) {
                decreaseQuantityBtn.addEventListener('click', () => {
                    let currentValue = parseInt(quantityInput.value);
                    const minValue = parseInt(quantityInput.min);
                    if (currentValue > minValue) {
                        quantityInput.value = currentValue - 1;
                    }
                });
    
                increaseQuantityBtn.addEventListener('click', () => {
                    let currentValue = parseInt(quantityInput.value);
                    const maxQuantity = parseInt(quantityInput.max);
                    if (currentValue < maxQuantity) {
                        quantityInput.value = currentValue + 1;
                    } else {
                        alert(`Ch·ªâ c√≤n t·ªëi ƒëa ${maxQuantity} s·∫£n ph·∫©m.`);
                    }
                });
    
                quantityInput.addEventListener('change', () => {
                    let currentValue = parseInt(quantityInput.value);
                    const maxQuantity = parseInt(quantityInput.max);
                    const minQuantity = parseInt(quantityInput.min);
                    
                    if (isNaN(currentValue) || currentValue < minQuantity) {
                        quantityInput.value = minQuantity;
                    } else if (currentValue > maxQuantity) {
                        quantityInput.value = maxQuantity;
                        alert(`Ch·ªâ c√≤n t·ªëi ƒëa ${maxQuantity} s·∫£n ph·∫©m.`);
                    }
                });
            }
    
            // ‚úÖ ENHANCED: Add to cart with better error handling
            if (addToCartBtn) {
                addToCartBtn.addEventListener('click', async () => {
                    if (!currentProductData || typeof currentProductData.productID === 'undefined') {
                        alert("Ch∆∞a t·∫£i ƒë∆∞·ª£c th√¥ng tin s·∫£n ph·∫©m ho·∫∑c ID s·∫£n ph·∫©m kh√¥ng h·ª£p l·ªá.");
                        return;
                    }
                    
                    if (currentProductData.stockQuantity < 1) {
                        alert("S·∫£n ph·∫©m ƒë√£ h·∫øt h√†ng.");
                        return;
                    }
    
                    const token = sessionStorage.getItem('token');
                    if (!token) {
                        alert("B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng.");
                        window.location.href = 'login.html';
                        return;
                    }
    
                    const quantity = parseInt(quantityInput.value);
                    if (isNaN(quantity) || quantity <= 0) {
                        alert("S·ªë l∆∞·ª£ng kh√¥ng h·ª£p l·ªá. Vui l√≤ng ch·ªçn √≠t nh·∫•t 1 s·∫£n ph·∫©m.");
                        return;
                    }
    
                    if (quantity > currentProductData.stockQuantity) {
                        alert(`S·ªë l∆∞·ª£ng b·∫°n ch·ªçn (${quantity}) v∆∞·ª£t qu√° s·ªë l∆∞·ª£ng t·ªìn kho (${currentProductData.stockQuantity}). Vui l√≤ng gi·∫£m s·ªë l∆∞·ª£ng.`);
                        quantityInput.value = currentProductData.stockQuantity;
                        return;
                    }
    
                    const cartItemPayload = {
                        productID: currentProductData.productID,
                        quantity: quantity
                    };
    
                    // Save original button state
                    const originalButtonText = addToCartBtn.innerHTML;
                    const originalButtonDisabled = addToCartBtn.disabled;
    
                    addToCartBtn.disabled = true;
                    addToCartBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>ƒêang th√™m...';
    
                    try {
                        const response = await fetch(`${API_BASE_URL}/Cart/items`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`
                            },
                            body: JSON.stringify(cartItemPayload)
                        });
    
                        if (response.ok) {
                            const updatedCart = await response.json();
                            console.log('‚úÖ Product added to cart:', updatedCart);
                            
                            // ‚úÖ ENHANCED: Better success feedback
                            const successMessage = `ƒê√£ th√™m ${quantity} "${currentProductData.productName}" v√†o gi·ªè h√†ng th√†nh c√¥ng!`;
                            
                            // Show success toast (you can implement a toast system)
                            alert(successMessage);
                            
                            // Optional: Update cart icon count if available
                            if (typeof window.updateCartIconCount === 'function') {
                                window.updateCartIconCount(updatedCart.totalItems);
                            }
                            
                        } else {
                            const errorData = await response.json().catch(() => ({ 
                                message: "L·ªói kh√¥ng x√°c ƒë·ªãnh t·ª´ m√°y ch·ªß." 
                            }));
                            
                            let errorMessage = `L·ªói ${response.status}: `;
    
                            switch (response.status) {
                                case 400:
                                    errorMessage = errorData.message || "Y√™u c·∫ßu kh√¥ng h·ª£p l·ªá. Vui l√≤ng ki·ªÉm tra l·∫°i s·ªë l∆∞·ª£ng ho·∫∑c s·∫£n ph·∫©m.";
                                    if (errorData.message && errorData.message.toLowerCase().includes("kh√¥ng ƒë·ªß h√†ng t·ªìn kho")) {
                                        // Refresh product data if stock issue
                                        await fetchProductDetails(currentProductData.productID);
                                    }
                                    break;
                                case 401:
                                    errorMessage = "Phi√™n ƒëƒÉng nh·∫≠p h·∫øt h·∫°n. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.";
                                    sessionStorage.removeItem('token');
                                    setTimeout(() => {
                                        window.location.href = 'login.html';
                                    }, 1500);
                                    break;
                                case 404:
                                    errorMessage = errorData.message || "S·∫£n ph·∫©m ho·∫∑c ng∆∞·ªùi d√πng kh√¥ng t√¨m th·∫•y.";
                                    break;
                                default:
                                    errorMessage = errorData.message || "Kh√¥ng th·ªÉ th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng. Vui l√≤ng th·ª≠ l·∫°i.";
                            }
                            
                            alert(errorMessage);
                            console.error('‚ùå Cart error:', errorData);
                        }
                    } catch (error) {
                        console.error('‚ùå Network error adding to cart:', error);
                        alert("ƒê√£ x·∫£y ra l·ªói k·∫øt n·ªëi m√°y ch·ªß. Vui l√≤ng th·ª≠ l·∫°i sau.");
                    } finally {
                        // Restore button state
                        addToCartBtn.disabled = originalButtonDisabled;
                        if (currentProductData && currentProductData.stockQuantity < 1) {
                            addToCartBtn.disabled = true;
                            addToCartBtn.innerHTML = '<i class="fas fa-times-circle mr-2"></i>H·∫øt h√†ng';
                        } else {
                            addToCartBtn.innerHTML = originalButtonText;
                        }
                    }
                });
            }
    
            // ‚úÖ ENHANCED: Buy Now button (optional)
            const buyNowBtn = document.getElementById('buyNowBtn');
            if (buyNowBtn) {
                buyNowBtn.addEventListener('click', () => {
                    if (!currentProductData || currentProductData.stockQuantity < 1) {
                        alert("S·∫£n ph·∫©m ƒë√£ h·∫øt h√†ng.");
                        return;
                    }
                    
                    const token = sessionStorage.getItem('token');
                    if (!token) {
                        alert("B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ mua h√†ng.");
                        window.location.href = 'login.html';
                        return;
                    }
                    
                    // Redirect to checkout with product info
                    const quantity = parseInt(quantityInput.value) || 1;
                    const checkoutUrl = `cart.html?productId=${currentProductData.productID}&quantity=${quantity}&direct=true`;
                    window.location.href = checkoutUrl;
                });
            }
    
            // --- Initialize ---
            const productIdFromUrl = getProductIdFromUrl();
            if (productIdFromUrl) {
                await fetchProductDetails(productIdFromUrl);
            } else {
                document.getElementById('productDetailContainer').innerHTML = 
                    '<p class="text-center text-red-500 col-span-full">Kh√¥ng t√¨m th·∫•y ID s·∫£n ph·∫©m trong URL.</p>';
            }
        });
    </script>
</body>

</html>